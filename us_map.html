
<!DOCTYPE html>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,300' rel='stylesheet' type='text/css'>
<style>


body {
    font-family: "Open Sans", sans-serif;
    font-size: 16px;
    padding: 40px;
}
h1{
  font-size: 3em;
  font-weight: 700;
  color: #0099FF;
}
a{
  color: #333399;
}
a:hover{
  color: #FF0099;
}

.states {
    fill: lightgrey;
    stroke: #fff; 
    stroke-width:1px;
}
.states:hover{
  opacity: .6;
}

.legendLinear text {
    font-size: 12px;
}
.d3-tip {
  line-height: 1;
  padding: 12px;
  background: rgba(43,43,43, 0.8);
  color: #fff;
  border-radius: 2px;
}


</style>
<body>
    <div id="circle"></div>
    <div id="vis-container"></div>
   
    <a href="/us_map.html?ap=true">Area</button>
    <a href="/us_map.html">Population</button>

    <h1>US Population Census</h1>

    

    <div id="vis"></div>
    <div id="vis1"></div>
    <div id="vis2"></div>

<script src="//d3js.org/d3.v3.min.js"></script>
<script src="//d3js.org/queue.v1.min.js"></script>
<script src="d3-legend.min.js"></script>
<script src="//d3js.org/topojson.v1.min.js"></script>
<script src="d3.legend.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script src="https://unpkg.com/textures@1.2.0/dist/textures.js"></script>


<script>


var width = 900;
    height = 700;

var A_P = window.location.href.indexOf('true') > -1;
// scale area too

// var dropdown = d3.select("#vis-container")
//             .insert("select", "svg")
//             .on("change",dropdownChange)

//             .selectAll("option")
//             .data(['Population','Area'])
//             .enter().append("option")
//             .attr("value", function(d){
//                 return d;
//             })
//             .text(function(d){
//                 return d;
//             })

// // Handler for dropdown value change
// var dropdownChange = function() {
//     console.log('change');
//            var url = window.location.origin +
//             window.location.pathname + A_P ? '?A_P=true' : '';
//             window.location.href = url;
//         };




var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-5, 0])
  .html(function(d) {
	
    var dataRow = countryById.get(d.properties.name);
       if (dataRow) {
        //    console.log(dataRow);
           return dataRow.State + ": " +"<br />"
           +"Under 5: "+ dataRow.Under5Years + "<br />" 
           +"5-13: " + dataRow.r5to13Years + "<br />"
           +"14-17: "+ dataRow.r14to17Years+ "<br />"
           +"18-24: " + dataRow.r18to24Years+ "<br />"
           +"25-44: "+ dataRow.r25to44Years+ "<br />"
           +"45-64: "+ dataRow.r45to64Years +"<br />"
           +"65 over: "+dataRow.r65YearsandOver;
       } else {
        //    console.log("no dataRow", d);
           return d.properties.name + ": No data.";
       }
  })

var tip1 = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-5, 0])
    .html(function(d) {

    var dataRow = countryById.get(d.properties.name);
        if (dataRow) {
        //    console.log(dataRow);
            return dataRow.State + ": " +"<br />"   
            +"5-13: " + dataRow.r5to13Years + "<br />"
        } else {
        //    console.log("no dataRow", d);
            return d.properties.name + ": No data.";
        }
    })

var tip2 = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-5, 0])
    .html(function(d) {

    var dataRow = countryById.get(d.properties.name);
        if (dataRow) {
       
            return dataRow.State + ": " +"<br />"   
            +"14-17: "+ dataRow.r14to17Years+ "<br />"
        } else {
       
            return d.properties.name + ": No data.";
        }
    })
var tip3 = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-5, 0])
    .html(function(d) {

    var dataRow = countryById.g
	d.Under5Years = +d.Under5Years;
	d.r5to13Years = +d.r5to13Years;
	d.r14to17Years = +d.r14to17Years;
	d.r18to24Years = +d.r18to24Years;
	d.r25to44Years = +d.r25to44Years;
 	d.r45to64Years = +d.r45to64Years;
    d.r65YearsandOver = +d.r65YearsandOver;
    d.areakm2 = +d.areakm2;et(d.properties.name);
        if (dataRow) {
       
            return dataRow.State + ": " +"<br />"   
            +"14-17: "+ dataRow.r18to24Years+ "<br />"
        } else {
       
            return d.properties.name + ": No data.";
        }
    })
var tip4 = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-5, 0])
    .html(function(d) {

    var dataRow = countryById.get(d.properties.name);
        if (dataRow) {
       
            return dataRow.State + ": " +"<br />"   
            +"14-17: "+ dataRow.r25to44Years+ "<br />"
        } else {
       
            return d.properties.name + ": No data.";
        }
    })
var tip5 = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-5, 0])
    .html(function(d) {

    var dataRow = countryById.get(d.properties.name);
        if (dataRow) {
       
            return dataRow.State + ": " +"<br />"   
            +"14-17: "+ dataRow.r45to64Years+ "<br />"
        } else {
            return d.properties.name + ": No data.";
        }
    })
var tip6 = d3.tip()
    .attr('class', 'd3-tip')
    .offset([-5, 0])
    .html(function(d) {

    var dataRow = countryById.get(d.properties.name);
        if (dataRow) {
       
            return dataRow.State + ": " +"<br />"   
            +"14-17: "+ dataRow.r65YearsandOver+ "<br />"
        } else {
       
            return d.properties.name + ": No data.";
        }
    })

const texture = textures.lines().stroke("darkorange").orientation("vertical").lighter().size(16).strokeWidth(1);
const texture1 = textures.lines().stroke("darkorange").orientation("3/8").lighter().size(16).strokeWidth(1);
const texture2 = textures.lines().stroke("darkorange").orientation("7/8").lighter().size(16).strokeWidth(1);
const texture3 = textures.lines().stroke("darkorange").orientation("4/8").lighter().size(16).strokeWidth(1);


const text = textures.circles().lighter();
const text1 = textures.circles().thinner();
const text2 = textures.circles().thicker();
const text3 = textures.circles().heavier();




var svg = d3.select('#vis').append('svg')
    .attr('width', width)
    .attr('height', height);

    svg.call(texture);

var svg1 = d3.select('#vis1').append('svg')
    .attr('width', width)
    .attr('height', height);
    svg1.call(texture1)
    svg1.call(texture2)
    svg1.call(texture3)


var svg2 = d3.select('#vis2').append('svg')
    .attr('width', width)
    .attr('height', height)
    svg2.call(text)
    svg2.call(text1)
    svg2.call(text3)
    svg2.call(text2)

var svg3 = d3.select('#vis2').append('svg')
    .attr('width', width)
    .attr('height', height)
  

var svg4 = d3.select('#vis2').append('svg')
    .attr('width', width)
    .attr('height', height)
   

var svg5 = d3.select('#vis2').append('svg')
    .attr('width', width)
    .attr('height', height)
 




svg.call(tip);

var projection = d3.geo.albersUsa()
    .scale(900) // mess with this if you want
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);

var radiusScale = d3.scale
                    .linear()
                    .range([1,25])
                    .domain([0, 5000000]);
var opacityScale = d3.scale
                    .linear()
                    .range([0.1,0.9])
                    .domain([0,5000000]);

var colorScale = d3.scale
                    .linear()
                    .range(["#E58606","#5D69B1","#52BCA3","#99C945","#24796C","#DAA51B"])
                    .domain([0,5000000])

var census_choice = ['Population','Area']



var countryById = d3.map();

// we use queue because we have 2 data files to load.
queue()
    .defer(d3.json, "USA.json")
    .defer(d3.json,"usa-state-capitals.json")
    .defer(d3.csv, "census.csv", typeAndSet) // process
    .await(loaded);

function typeAndSet(d) {
	
	d.Under5Years = +d.Under5Years;
	d.r5to13Years = +d.r5to13Years;
	d.r14to17Years = +d.r14to17Years;
	d.r18to24Years = +d.r18to24Years;
	d.r25to44Years = +d.r25to44Years;
 	d.r45to64Years = +d.r45to64Years;
    d.r65YearsandOver = +d.r65YearsandOver;
    d.areakm2 = +d.areakm2;
	countryById.set(d.State,d)
	// console.log(countryById);
    return d;
};
// function getColor(d){
//     var dataRow = countryById.get(d.properties.name);
//     if (dataRow & A_P) {
//         return colorScale(dataRow.areakm2)
//     }
//     return 'no data'
// };
function getRadius(d) {
    var dataRow = countryById.get(d.properties.name);
console.log(dataRow);
    if (!A_P) {
       
        return radiusScale(dataRow.Under5Years);
    } else if (A_P) {
        return radiusScale(dataRow.areakm2)
    }
    return 5;
    };


function r5_13_Radius(d) {
    var dataRow = countryById.get(d.properties.name);
console.log(dataRow);
    if (!A_P) {
       
        return radiusScale(dataRow.r5to13Years);
    } 
    return 5;
    };

function r14_17_Radius(d) {
    var dataRow = countryById.get(d.properties.name);
console.log(dataRow);
    if (!A_P) {
    //    console.log(dataRow);
        return radiusScale(dataRow.r14to17Years);
    } 
    return 5;
    };

function r18_24_Radius(d) {
    var dataRow = countryById.get(d.properties.name);
console.log(dataRow);
    if (!A_P ) {
    //    console.log(dataRow);
        return radiusScale(dataRow.r18to24Years);
    } 
    return 5;
    };

function r25_44_Radius(d) {
    var dataRow = countryById.get(d.properties.name);
console.log(dataRow);
    if (!A_P) {
        // conso!A_PdataRow);
        return radiusScale(dataRow.r25to44Years);
    }
    return 5;
    };

function r45_64_Radius(d) {
    var dataRow = countryById.get(d.properties.name);
console.log(dataRow);
    if (!A_P) {
    //    console.log(dataRow);
        return radiusScale(dataRow.r45to64Years);
    } 
    return 5;
    };

function Over65_Radius(d) {
    var dataRow = countryById.get(d.properties.name);
console.log(dataRow);
    if (!A_P ) {
    //    console.log(dataRow);
        return radiusScale(dataRow.r45to64Years);
    } 
    return 5;
    
    };

function opacity1(d){
    var dataRow = countryById.get(d.properties.name);
    if (!A_P){
        return opacityScale(dataRow.Under5Years)
    } else if (A_P){
        return opacityScale(dataRow.areakm2)
    }
    return 0;
}


function opacity2(d){

    var dataRow = countryById.get(d.properties.name);
    console.log(dataRow);
    if (!A_P){
        return opacityScale(dataRow.r5to13Years)
    } 
    return 0;
};

function opacity3(d){
    var dataRow = countryById.get(d.properties.name);
    console.log(dataRow);
    if (!A_P){
        return opacityScale(dataRow.r14to17Years)
    } 
    return 0;
};

function opacity4(d){
    var dataRow = countryById.get(d.properties.name);
    console.log(dataRow);
    if (!A_P){
        return opacityScale(dataRow.r18to24Years)
    } 
    return 0;
};

function opacity5(d){
    var dataRow = countryById.get(d.properties.name);
    console.log(dataRow);
    if (!A_P){
        return opacityScale(dataRow.r25to44Years)
    } 
    return 0;
};

function opacity6(d){
    var dataRow = countryById.get(d.properties.name);
    console.log(dataRow);
    if (!A_P){
        return opacityScale(dataRow.r45to64Years)
    }
    return 0;
};

function opacity7(d){
    var dataRow = countryById.get(d.properties.name);
    console.log(dataRow);
    if (!A_P){
        return opacityScale(dataRow.r65YearsandOver);
    }
    return 0;
};


  


// main data binding function
function loaded(error, usa,coor, census) {

    
    // console.log(census);
    // console.log(coor);
    // console.log(usa);

    var area = census.map(function(d){return d.areakm2});

    var states = topojson.feature(usa, usa.objects.units).features;
    
    
    var colormap = svg.append("g")
        .selectAll('states')
        .data(states)
        .enter()
        .append('path')
        .attr('class', 'states')
        .attr('d', path)
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);});
      
    
    var colormap1 = svg1.append("g")
        .selectAll('states')
        .data(states)
        .enter()
        .append('path')
        .attr('class', 'states')
        .attr('d', path)
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);});
     
    
    var colormap2 = svg2.append("g")
        .selectAll('states')
        .data(states)
        .enter()
        .append('path')
        .attr('class', 'states')
        .attr('d', path)
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);});
  
       
    
    var linesonmap = svg1.append("g")
        .selectAll('states')
        .data(states)
        .enter()
        .append("path")
        .attr("class","states")
        .attr("d",path)
        .style('fill', function(d,i){
            var dataRow = countryById.get(d.properties.name)
            if (dataRow){
                var array = [dataRow.Under5Years,dataRow.r5to13Years,dataRow.r14to17Years,dataRow.r18to24Years,dataRow.r25to44Years,dataRow.r45to64Years,dataRow.r65YearsandOver] 
                var sum_array = array.reduce(function(a,b){
                    return a+b;
                },0);
                if (sum_array >= 1000 && sum_array <= 10000){
                    // console.log(sum_array);
                    return texture.url();
                } else if (sum_array > 10000 && sum_array <= 100000 ) {
                    // console.log(sum_array);
                    return texture1.url();
                } else if (sum_array > 100000 && sum_array <= 1000000){
                    // console.log(sum_array);
                    return texture2.url();
                } else {
                    // console.log(sum_array);
                    return texture3.url();
                };
            };
            return "nothing";
        })
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);});

    var texturemap = svg2.append('g')
                        .selectAll('states')
                        .data(states)
                        .enter()
                        .append('path')
                        .attr('class','states')
                        .attr('d',path)
                        .style('fill', function(d,i){
                            var dataRow = countryById.get(d.properties.name)
                            if (dataRow){
                                var array = [dataRow.Under5Years,dataRow.r5to13Years,dataRow.r14to17Years,dataRow.r18to24Years,dataRow.r25to44Years,dataRow.r45to64Years,dataRow.r65YearsandOver] 
                                var sum_array = array.reduce(function(a,b){
                                    return a+b;
                                },0);
                                if (sum_array >= 1000 && sum_array <= 10000){
                                    // console.log(sum_array);
                                    return text.url();
                                } else if (sum_array > 10000 && sum_array <= 100000 ) {
                                    // console.log(sum_array);
                                    return text1.url();
                                } else if (sum_array > 100000 && sum_array <= 1000000){
                                    // console.log(sum_array);
                                    return text2.url();
                                } else {
                                    // console.log(sum_array);
                                    return text3.url();
                                };
                            };
                            return "nothing";
                        })
                        .on('mouseover', (d) => { tip.show(d)})
                        .on('mouseout', (d) => { tip.hide(d);});



    var under_5_bubbles = svg.append('g')

        .attr('class', 'bubble')
        .selectAll("circle")
        .data(states)
        .enter().append("circle")
        .attr("transform", function(d) { return "translate(" + path.centroid(d) + ")"; })
        .attr("r", function(d, i) {
            return getRadius(d);
        })
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);})
        .attr("fill","#E58606")
        .style("opacity",opacity1);

    var r5to13Years_bubles = svg.append('g')
        .attr('class','bubble')
        .selectAll('circle')
        .data(states)
        .enter()
        .append("circle")
        .attr("transform",function(d){
            return "translate(" + path.centroid(d) + ")";
        })
        .attr("r",function(d,i){
            return r5_13_Radius(d)
        })
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);})
        .attr("fill","#5D69B1")
        .style("opacity",opacity2);

    var r14to17Years_bubbles = svg.append('g')
        .attr('class','bubble')
        .selectAll('circle')
        .data(states)
        .enter()
        .append("circle")
        .attr("transform",function(d){
            return "translate(" + path.centroid(d) + ")";
        })
        .attr("r",function(d,i){
            return r14_17_Radius(d)
        })
        .attr("fill","#52BCA3")
        .style("opacity",opacity3);
    
    var r18to24Years_bubbles = svg.append('g')
        .attr('class','bubble')
        .selectAll('circle')
        .data(states)
        .enter()
        .append("circle")
        .attr("transform",function(d){
            return "translate(" + path.centroid(d) + ")";
        })
        .attr("r",function(d,i){
            return r18_24_Radius(d)
        })
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);})
        .attr("fill","#99C945")
        .style("opacity",opacity4);
    
    var r25to44Years_bubbles = svg.append('g')
        .attr('class','bubble')
        .selectAll('circle')
        .data(states)
        .enter()
        .append("circle")
        .attr("transform",function(d){
            return "translate(" + path.centroid(d) + ")";
        })
        .attr("r",function(d,i){
            return r25_44_Radius(d)
        })
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);})
        .attr("fill","#CC61B0")
        .style("opacity",opacity5);
    
    var r45to64Years_bubbles = svg.append('g')
        .attr('class','bubble')
        .selectAll('circle')
        .data(states)
        .enter()
        .append("circle")
        .attr("transform",function(d){
            return "translate(" + path.centroid(d) + ")";
        })
        .attr("r",function(d,i){
            console.log(d,'!!!!');
            return r45_64_Radius(d)
        })
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);})
        .attr("fill","#24796C")
        .style("opacity",opacity6);
    
    var Over65_bubbles = svg.append('g')
        .attr('class','bubble')
        .selectAll('circle')
        .data(states)
        .enter()
        .append("circle")
        .attr("transform",function(d){
            return "translate(" + path.centroid(d) + ")";
        })
        .attr("r",function(d,i){
            return Over65_Radius(d)
        })
        .on('mouseover', (d) => { tip.show(d)})
        .on('mouseout', (d) => { tip.hide(d);})
        .attr("fill","#DAA51B")
        .style("opacity",opacity7);

        // cs cy set location
    svg.append("circle").attr("cx",50).attr("cy",15).attr("r", 6).style("fill", "#E58606")
    svg.append("circle").attr("cx",50).attr("cy",30).attr("r", 6).style("fill", "#5D69B1")
    svg.append("circle").attr("cx",50).attr("cy",45).attr("r", 6).style("fill", "#52BCA3")
    svg.append("circle").attr("cx",50).attr("cy",60).attr("r", 6).style("fill", "#99C945")
    svg.append("circle").attr("cx",50).attr("cy",75).attr("r", 6).style("fill", "#CC61B0")
    svg.append("circle").attr("cx",50).attr("cy",90).attr("r", 6).style("fill", "#24796C")
    svg.append("circle").attr("cx",50).attr("cy",105).attr("r", 6).style("fill", "#DAA51B")

    svg.append("text").attr("x", 60).attr("y", 20).text("5 and under").style("font-size", "15px").attr("alignment-baseline","middle")
    svg.append("text").attr("x", 60).attr("y", 35).text("5 - 13 Age").style("font-size", "15px").attr("alignment-baseline","middle")
    svg.append("text").attr("x", 60).attr("y", 50).text("14 - 17 Age").style("font-size", "15px").attr("alignment-baseline","middle")
    svg.append("text").attr("x", 60).attr("y", 65).text("18 - 24 Age").style("font-size", "15px").attr("alignment-baseline","middle")
    svg.append("text").attr("x", 60).attr("y", 80).text("25 - 44 Age").style("font-size", "15px").attr("alignment-baseline","middle")
    svg.append("text").attr("x", 60).attr("y", 95).text("45 - 65 Age").style("font-size", "15px").attr("alignment-baseline","middle")
    svg.append("text").attr("x", 60).attr("y", 110).text("Age 64 and over").style("font-size", "15px").attr("alignment-baseline","middle")

    svg1.append("rect").attr("x",10).attr("y",5).attr("width",50).attr("height",15).attr("fill",texture.url())
    svg1.append("rect").attr("x",10).attr("y",25).attr("width",50).attr("height",15).attr("fill",texture1.url())
    svg1.append("rect").attr("x",10).attr("y",45).attr("width",50).attr("height",15).attr("fill",texture2.url())
    svg1.append("rect").attr("x",10).attr("y",65).attr("width",50).attr("height",15).attr("fill",texture3.url())

    svg1.append("text").attr("x", 60).attr("y", 15).text("text").style("font-size", "15px").attr("alignment-baseline","middle")
    svg1.append("text").attr("x", 60).attr("y", 35).text("text a").style("font-size", "15px").attr("alignment-baseline","middle")
    svg1.append("text").attr("x", 60).attr("y", 55).text("text b").style("font-size", "15px").attr("alignment-baseline","middle")
    svg1.append("text").attr("x", 60).attr("y", 75).text("text c").style("font-size", "15px").attr("alignment-baseline","middle")
    

}

</script>
</body>
</html>